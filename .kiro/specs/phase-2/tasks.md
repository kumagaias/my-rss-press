# 実装タスクリスト Phase 2

## 概要

このタスクリストは、requirements.mdとdesign.mdに基づいてMyRSSPress Phase 2を実装するための具体的なタスクを定義します。各タスクには完了基準を明確にするための受入基準が含まれています。

## タスク実行原則

1. **順序に従う**: タスクを番号順に実行
2. **受入基準を確認**: 各タスクのすべての受入基準を満たす
3. **テストを実行**: タスク完了後は必ず`make test`を実行
4. **デプロイと検証**: 可能な場合は本番環境にデプロイして動作を確認
5. **ブランチ管理**: `feat/task-X.X-<description>`ブランチで作業し、PRを作成してマージ

## タスクリスト

- [x] 1. データモデルとDynamoDBスキーマの拡張
- [ ] 2. バックエンドサービスの実装
- [ ] 3. APIエンドポイントの拡張
- [ ] 4. フロントエンドコンポーネントの実装
- [ ] 5. 統合とE2Eテスト
- [ ] 6. 最終デプロイと検証

---

## 1. データモデルとDynamoDBスキーマの拡張

### 1.1 データモデルの更新

- [ ] 1.1.1 Locale型の定義
  - `backend/src/models/newspaper.ts`に`Locale`型を追加
  - `'ja' | 'en-US' | 'en-GB'`の3つのロケールをサポート
  - **受入基準:**
    - [ ] `Locale`型が定義されている
    - [ ] TypeScriptコンパイルが成功する
    - [ ] 型定義のユニットテストが通る
  - _要件: 8.2, 8.3, 8.4_

- [ ] 1.1.2 NewspaperDataインターフェースの拡張
  - `seriesId`、`publishDate`、`locale`、`summary`フィールドを追加
  - `newspaperId`の形式を`{seriesId}_{YYYY-MM-DD}`に変更
  - **受入基準:**
    - [ ] 新しいフィールドがすべて追加されている
    - [ ] 既存のPhase 1フィールドも保持されている
    - [ ] TypeScriptコンパイルが成功する
  - _要件: 4.1, 9.7, 10.1_

- [ ] 1.1.3 Articleインターフェースの拡張
  - `imageAttribution`フィールドを追加（Unsplash用）
  - `photographer`、`photographerUrl`、`photoUrl`を含む
  - **受入基準:**
    - [ ] `imageAttribution`フィールドが追加されている
    - [ ] オプショナルフィールドとして定義されている
    - [ ] TypeScriptコンパイルが成功する
  - _要件: 6.6_

### 1.2 DynamoDBスキーマの更新

- [ ] 1.2.1 テーブル構造の変更
  - PKを`SERIES#{seriesId}`、SKを`DATE#{publishDate}`に変更
  - Terraform設定を更新
  - **受入基準:**
    - [ ] `infra/modules/dynamodb/main.tf`が更新されている
    - [ ] `terraform plan`が成功する
    - [ ] 既存データとの互換性が保たれている
  - _要件: 4.2_

- [ ] 1.2.2 GSI: PublicNewspapersByDateの作成
  - PK: `PUBLIC#{locale}`、SK: `DATE#{publishDate}#{seriesId}`
  - プロジェクション: ALL
  - **受入基準:**
    - [ ] GSIが定義されている
    - [ ] `terraform apply`が成功する
    - [ ] GSIクエリが正しく動作する
  - _要件: 4.3, 4.4_

- [ ] 1.2.3 GSI: PublicNewspapersByViewsの作成
  - PK: `PUBLIC#{locale}`、SK: `VIEWS#{viewCount}#{seriesId}`
  - プロジェクション: ALL
  - **受入基準:**
    - [ ] GSIが定義されている
    - [ ] `terraform apply`が成功する
    - [ ] GSIクエリが正しく動作する
  - _要件: 4.3, 4.4_


## 2. バックエンドサービスの実装

### 2.1 SummaryGeneratorServiceの実装

- [ ] 2.1.1 サマリー生成サービスの基本実装
  - `backend/src/services/summaryGeneratorService.ts`を作成
  - Bedrock Runtime APIクライアントを設定
  - `generateSummary()`メソッドを実装
  - **受入基準:**
    - [ ] サービスファイルが作成されている
    - [ ] Bedrock Runtime APIに接続できる
    - [ ] Claude 3.5 Haikuモデルを使用している
    - [ ] ユニットテスト（モック使用）が通る
  - _要件: 9.1, 9.2, 9.3_

- [ ] 2.1.2 プロンプト構築ロジックの実装
  - `buildSummaryPrompt()`メソッドを実装
  - ロケールに応じた言語でプロンプトを生成
  - 記事タイトルのリストを含める
  - **受入基準:**
    - [ ] 日本語と英語のプロンプトが正しく生成される
    - [ ] 記事タイトルが適切にフォーマットされている
    - [ ] ユニットテストが通る
  - _要件: 9.4, 9.6_

- [ ] 2.1.3 レスポンスパースとバリデーション
  - `parseSummaryResponse()`メソッドを実装
  - 3行のテキストを抽出
  - バリデーションを実施
  - **受入基準:**
    - [ ] 3行のサマリーが正しく抽出される
    - [ ] 不正なレスポンスを検出できる
    - [ ] ユニットテストが通る
  - _要件: 9.5_

- [ ] 2.1.4 フォールバックサマリーの実装
  - `getDefaultSummary()`メソッドを実装
  - Bedrock失敗時のデフォルトサマリーを生成
  - ロケールに応じた言語で生成
  - **受入基準:**
    - [ ] デフォルトサマリーが生成される
    - [ ] 記事数と主要トピックを含む
    - [ ] タイムアウト時に正しく動作する
    - [ ] ユニットテストが通る
  - _要件: 9.10, 9.13_

### 2.2 DateRangeFilterServiceの実装

- [ ] 2.2.1 日付範囲フィルタリングの実装
  - `backend/src/services/dateRangeFilterService.ts`を作成
  - `filterArticlesByDateRange()`メソッドを実装
  - 前日0時から当日23時59分59秒までをフィルタリング
  - **受入基準:**
    - [ ] 指定日付範囲の記事が正しくフィルタリングされる
    - [ ] タイムゾーンが正しく処理される
    - [ ] ユニットテストが通る
  - _要件: 1.1, 1.2_

- [ ] 2.2.2 日付範囲拡張ロジックの実装
  - 記事が3件未満の場合、7日間まで拡張
  - 1日ずつ遡って記事を取得
  - **受入基準:**
    - [ ] 記事不足時に7日間まで拡張される
    - [ ] 最小記事数（3件）に達したら停止する
    - [ ] ユニットテストが通る
  - _要件: 1.3, 1.4, 1.5_

- [ ] 2.2.3 記事ソートの実装
  - 公開日の新しい順に並び替え
  - **受入基準:**
    - [ ] 記事が公開日の降順で並んでいる
    - [ ] ユニットテストが通る
  - _要件: 1.6_

### 2.3 UnsplashServiceの実装

- [ ] 2.3.1 Unsplash API統合
  - `backend/src/services/unsplashService.ts`を作成
  - `searchPhoto()`メソッドを実装
  - API認証を設定
  - **受入基準:**
    - [ ] Unsplash APIに接続できる
    - [ ] 検索クエリで画像を取得できる
    - [ ] 5秒タイムアウトが設定されている
    - [ ] ユニットテスト（モック使用）が通る
  - _要件: 6.4, 6.5_

- [ ] 2.3.2 検索クエリ構築
  - `buildSearchQuery()`メソッドを実装
  - 記事タイトルからキーワードを抽出
  - **受入基準:**
    - [ ] 記事タイトルから適切なキーワードが抽出される
    - [ ] URLエンコードが正しく行われる
    - [ ] ユニットテストが通る
  - _要件: 6.5_

- [ ] 2.3.3 帰属表示フォーマット
  - `formatAttribution()`メソッドを実装
  - 写真家名とUnsplashリンクを含める
  - **受入基準:**
    - [ ] 帰属情報が正しくフォーマットされる
    - [ ] 必要なフィールドがすべて含まれる
    - [ ] ユニットテストが通る
  - _要件: 6.6, 6.7, 6.8_

- [ ] 2.3.4 フォールバック処理
  - API失敗時のプレースホルダー画像処理
  - レート制限対応
  - **受入基準:**
    - [ ] API失敗時にnullを返す
    - [ ] タイムアウト時に適切に処理される
    - [ ] ユニットテストが通る
  - _要件: 6.9, 6.10_

### 2.4 NewspaperServiceの拡張

- [ ] 2.4.1 getNewspaperByDateの実装
  - シリーズIDと日付で新聞を取得
  - DynamoDBクエリを実装
  - **受入基準:**
    - [ ] 特定日付の新聞が取得できる
    - [ ] 存在しない場合はnullを返す
    - [ ] ユニットテストが通る
  - _要件: 4.4_

- [ ] 2.4.2 getNewspaperSeriesの実装
  - シリーズIDで全新聞を取得
  - 日付の降順で並び替え
  - **受入基準:**
    - [ ] シリーズの全新聞が取得できる
    - [ ] 日付の新しい順に並んでいる
    - [ ] ユニットテストが通る
  - _要件: 4.4_

- [ ] 2.4.3 regenerateNewspaperの実装
  - 既存新聞を取得
  - 同じフィードURLで新しい記事を取得
  - 重要度を再計算
  - サマリーを再生成
  - **受入基準:**
    - [ ] 新聞が正しく再生成される
    - [ ] メタデータが保持される
    - [ ] articlesとupdatedAtが更新される
    - [ ] ユニットテストが通る
  - _要件: 3.4, 3.5, 3.6, 3.7, 3.8_

- [ ] 2.4.4 searchNewspapersByNameの実装
  - 新聞名で検索（大文字小文字区別なし、部分一致）
  - ロケールフィルタリング対応
  - **受入基準:**
    - [ ] 新聞名で検索できる
    - [ ] 大文字小文字を区別しない
    - [ ] 部分一致で検索できる
    - [ ] ユニットテストが通る
  - _要件: 10.5, 10.6, 10.7_

- [ ] 2.4.5 getPublicNewspapersのロケール対応
  - ロケールパラメータを追加
  - GSIクエリを更新
  - **受入基準:**
    - [ ] ロケールでフィルタリングできる
    - [ ] 'all'の場合は全ロケールを返す
    - [ ] ユニットテストが通る
  - _要件: 8.4, 8.5, 8.6, 8.7, 8.10_


## 3. APIエンドポイントの拡張

### 3.1 新聞生成エンドポイントの更新

- [ ] 3.1.1 POST /api/newspapersの拡張
  - `seriesId`、`publishDate`、`locale`パラメータを追加
  - サマリー生成を統合
  - Unsplash画像取得を統合
  - **受入基準:**
    - [ ] 新しいパラメータを受け付ける
    - [ ] サマリーが生成される
    - [ ] 画像がない場合Unsplashから取得される
    - [ ] 統合テストが通る
  - _要件: 9.1, 6.3_

- [ ] 3.1.2 レスポンス形式の更新
  - `seriesId`、`publishDate`、`summary`を含める
  - **受入基準:**
    - [ ] レスポンスに新しいフィールドが含まれる
    - [ ] 既存のPhase 1フィールドも保持される
    - [ ] 統合テストが通る
  - _要件: 9.7_

### 3.2 新聞取得エンドポイントの追加

- [ ] 3.2.1 GET /api/newspapers/:seriesId/:publishDateの実装
  - 日付ベースで新聞を取得
  - `getNewspaperByDate()`を呼び出し
  - **受入基準:**
    - [ ] エンドポイントが実装されている
    - [ ] 特定日付の新聞が取得できる
    - [ ] 存在しない場合は404を返す
    - [ ] 統合テストが通る
  - _要件: 2.3, 2.4_

- [ ] 3.2.2 GET /api/newspapers/series/:seriesIdの実装
  - シリーズの全新聞を取得
  - `getNewspaperSeries()`を呼び出し
  - **受入基準:**
    - [ ] エンドポイントが実装されている
    - [ ] シリーズの全新聞が取得できる
    - [ ] 日付の降順で並んでいる
    - [ ] 統合テストが通る
  - _要件: 4.4_

### 3.3 再生成エンドポイントの実装

- [ ] 3.3.1 POST /api/newspapers/:newspaperId/regenerateの実装
  - `regenerateNewspaper()`を呼び出し
  - 更新された新聞を返す
  - **受入基準:**
    - [ ] エンドポイントが実装されている
    - [ ] 新聞が正しく再生成される
    - [ ] 更新されたデータが返される
    - [ ] 統合テストが通る
  - _要件: 3.4, 3.9_

- [ ] 3.3.2 レート制限の設定
  - 5リクエスト/分に制限
  - **受入基準:**
    - [ ] レート制限が設定されている
    - [ ] 制限超過時に429を返す
    - [ ] 統合テストが通る
  - _要件: セキュリティ_

### 3.4 検索エンドポイントの実装

- [ ] 3.4.1 GET /api/newspapers/searchの実装
  - クエリパラメータ`q`で検索
  - ロケールフィルタリング対応
  - `searchNewspapersByName()`を呼び出し
  - **受入基準:**
    - [ ] エンドポイントが実装されている
    - [ ] 新聞名で検索できる
    - [ ] ロケールでフィルタリングできる
    - [ ] 統合テストが通る
  - _要件: 10.4, 10.5_

### 3.5 公開新聞取得エンドポイントの更新

- [ ] 3.5.1 GET /api/newspapersのロケール対応
  - `locale`クエリパラメータを追加
  - GSIクエリを更新
  - **受入基準:**
    - [ ] ロケールパラメータを受け付ける
    - [ ] ロケールでフィルタリングできる
    - [ ] 統合テストが通る
  - _要件: 8.10_

### 3.6 入力バリデーションの追加

- [ ] 3.6.1 日付バリデーション
  - YYYY-MM-DD形式をチェック
  - 未来の日付を拒否
  - **受入基準:**
    - [ ] 無効な日付形式で400を返す
    - [ ] 未来の日付で400を返す
    - [ ] ユニットテストが通る
  - _要件: 2.5, 2.6_

- [ ] 3.6.2 ロケールバリデーション
  - 'ja' | 'en-US' | 'en-GB'のみ許可
  - **受入基準:**
    - [ ] 無効なロケールで400を返す
    - [ ] ユニットテストが通る
  - _要件: 8.2_

- [ ] 3.6.3 検索クエリバリデーション
  - 最大100文字に制限
  - **受入基準:**
    - [ ] 長すぎるクエリで400を返す
    - [ ] ユニットテストが通る
  - _要件: 10.4_


## 4. フロントエンドコンポーネントの実装

### 4.1 国際化（i18n）の拡張

- [ ] 4.1.1 Locale型の更新
  - `frontend/lib/i18n.ts`を更新
  - `'ja' | 'en-US' | 'en-GB'`に拡張
  - **受入基準:**
    - [ ] Locale型が3つのロケールをサポート
    - [ ] TypeScriptコンパイルが成功する
  - _要件: 10.3_

- [ ] 4.1.2 タイムゾーン設定の追加
  - `timezones`オブジェクトを定義
  - Asia/Tokyo、America/New_York、Europe/Londonを設定
  - **受入基準:**
    - [ ] タイムゾーンマッピングが定義されている
    - [ ] 各ロケールに対応するタイムゾーンが正しい
  - _要件: 10.3_

- [ ] 4.1.3 formatNewspaperDate関数の実装
  - ロケールとタイムゾーンに応じた日付フォーマット
  - `toLocaleDateString()`を使用
  - **受入基準:**
    - [ ] 日本語: 「2025年12月8日 月曜日」形式
    - [ ] 英語（米国）: 「Monday, December 8, 2025」形式
    - [ ] 英語（英国）: 「Monday, 8 December 2025」形式
    - [ ] ユニットテストが通る
  - _要件: 10.4, 10.5, 10.6, 10.10, 10.11_

- [ ] 4.1.4 Phase 2翻訳キーの追加
  - 検索、日付ナビゲーション、再生成などの翻訳を追加
  - 日本語と英語の両方
  - **受入基準:**
    - [ ] すべての新しいUI要素の翻訳が追加されている
    - [ ] 日本語と英語の翻訳が一致している
  - _要件: 全般_

### 4.2 検索コンポーネントの実装

- [ ] 4.2.1 NewspaperSearchComponentの作成
  - `frontend/components/features/newspaper/NewspaperSearch.tsx`を作成
  - 検索フィールドとクリアボタンを実装
  - **受入基準:**
    - [ ] 検索フィールドが表示される
    - [ ] 検索アイコン（🔍）が左側に表示される
    - [ ] クリアボタン（×）が右側に表示される
    - [ ] 高さ44px以上（タッチフレンドリー）
    - [ ] コンポーネントテストが通る
  - _要件: 10.1, 10.2, 10.13_

- [ ] 4.2.2 リアルタイム検索フィルタリング
  - 入力時に即座にフィルタリング
  - デバウンス処理（300ms）
  - **受入基準:**
    - [ ] 入力時にリアルタイムでフィルタリングされる
    - [ ] デバウンスが正しく動作する
    - [ ] ユニットテストが通る
  - _要件: 10.4, 10.7_

- [ ] 4.2.3 検索ロジックの実装
  - 大文字小文字区別なし
  - 部分一致
  - **受入基準:**
    - [ ] 大文字小文字を区別せずに検索できる
    - [ ] 部分一致で検索できる
    - [ ] 空の検索でも全件表示される
    - [ ] ユニットテストが通る
  - _要件: 10.6, 10.7, 10.8_

- [ ] 4.2.4 検索結果表示
  - 結果が0件の場合のメッセージ表示
  - **受入基準:**
    - [ ] 結果0件時に「検索結果が見つかりませんでした」を表示
    - [ ] コンポーネントテストが通る
  - _要件: 10.9_

### 4.3 日付ナビゲーションコンポーネントの実装

- [ ] 4.3.1 DateNavigationComponentの作成
  - `frontend/components/features/newspaper/DateNavigation.tsx`を作成
  - 「前の日」ボタンを実装
  - **受入基準:**
    - [ ] 「前の日」ボタンが表示される
    - [ ] 現在の日付が表示される
    - [ ] コンポーネントテストが通る
  - _要件: 5.1_

- [ ] 4.3.2 日付範囲チェックロジック
  - 今日から2日以内かチェック
  - 範囲外の場合はボタンを無効化
  - **受入基準:**
    - [ ] 2日以内の場合はボタンが有効
    - [ ] 2日を超える場合はボタンが無効
    - [ ] ユニットテストが通る
  - _要件: 5.2, 5.7, 5.10, 5.11_

- [ ] 4.3.3 ツールチップの実装
  - 無効化されたボタンにツールチップを表示
  - **受入基準:**
    - [ ] ツールチップに「過去2日分のみ閲覧可能です」と表示
    - [ ] コンポーネントテストが通る
  - _要件: 5.8_

- [ ] 4.3.4 前日新聞取得ロジック
  - 前日の日付を計算
  - APIを呼び出して新聞を取得
  - 存在しない場合のメッセージ表示
  - **受入基準:**
    - [ ] 前日の新聞に遷移できる
    - [ ] 存在しない場合は「前の日の新聞はありません」を表示
    - [ ] ユニットテストが通る
  - _要件: 5.3, 5.4, 5.5, 5.6_

### 4.4 サマリー表示コンポーネントの実装

- [ ] 4.4.1 SummaryDisplayComponentの作成
  - `frontend/components/features/newspaper/SummaryDisplay.tsx`を作成
  - 3行サマリーを表示
  - **受入基準:**
    - [ ] サマリーが新聞タイトルと記事リストの間に表示される
    - [ ] 3行のテキストが表示される
    - [ ] コンポーネントテストが通る
  - _要件: 9.8_

- [ ] 4.4.2 スタイリングの実装
  - 薄いグレー背景または枠線
  - 適度な行間
  - **受入基準:**
    - [ ] フォントサイズが中サイズ
    - [ ] 行間が適度に設定されている
    - [ ] 背景または枠線で区別されている
    - [ ] コンポーネントテストが通る
  - _要件: 9.9_

- [ ] 4.4.3 ローディング状態の実装
  - サマリー生成中のインジケーター
  - **受入基準:**
    - [ ] ローディング中にインジケーターが表示される
    - [ ] コンポーネントテストが通る
  - _要件: 9.11_

### 4.5 再生成ボタンコンポーネントの実装

- [ ] 4.5.1 RegenerateButtonComponentの作成
  - `frontend/components/features/newspaper/RegenerateButton.tsx`を作成
  - 再生成ボタンを実装
  - **受入基準:**
    - [ ] 再生成ボタンが表示される
    - [ ] コンポーネントテストが通る
  - _要件: 3.1_

- [ ] 4.5.2 確認ダイアログの実装
  - ボタンクリック時に確認ダイアログを表示
  - **受入基準:**
    - [ ] 確認ダイアログが表示される
    - [ ] 「現在の新聞を最新の記事で再生成しますか？」メッセージを含む
    - [ ] コンポーネントテストが通る
  - _要件: 3.2, 3.3_

- [ ] 4.5.3 再生成処理の実装
  - APIを呼び出して再生成
  - 完了後にページをリロード
  - **受入基準:**
    - [ ] 再生成APIが呼び出される
    - [ ] 完了後にページがリロードされる
    - [ ] ローディング中にインジケーターが表示される
    - [ ] ユニットテストが通る
  - _要件: 3.4, 3.9, 3.10_

### 4.6 言語フィルタコンポーネントの拡張

- [ ] 4.6.1 LanguageFilterComponentの更新
  - 3つのロケールオプションを追加
  - 🇯🇵 日本語、🇺🇸 English (US)、🇬🇧 English (UK)
  - **受入基準:**
    - [ ] 4つのオプション（All + 3ロケール）が表示される
    - [ ] 国旗絵文字が正しく表示される
    - [ ] コンポーネントテストが通る
  - _要件: 8.2_

- [ ] 4.6.2 フィルタリングロジックの実装
  - 選択されたロケールで新聞をフィルタリング
  - **受入基準:**
    - [ ] ロケール選択時に即座にフィルタリングされる
    - [ ] ソート順と組み合わせて動作する
    - [ ] ユニットテストが通る
  - _要件: 8.4, 8.5, 8.6, 8.7, 8.8, 8.9_

- [ ] 4.6.3 言語バッジの実装
  - 新聞カードに言語バッジを表示
  - **受入基準:**
    - [ ] 各新聞カードにバッジが表示される
    - [ ] 正しい国旗絵文字とテキストが表示される
    - [ ] コンポーネントテストが通る
  - _要件: 8.13, 8.14_


### 4.7 新聞ページの更新

- [ ] 4.7.1 新聞ヘッダーの更新
  - 日付ナビゲーションを追加
  - 再生成ボタンを追加
  - ロケール対応の日付表示
  - **受入基準:**
    - [ ] 日付ナビゲーションが表示される
    - [ ] 再生成ボタンが表示される
    - [ ] 日付がロケールに応じた形式で表示される
    - [ ] コンポーネントテストが通る
  - _要件: 5.1, 3.1, 10.8_

- [ ] 4.7.2 サマリーセクションの追加
  - 新聞タイトルと記事リストの間にサマリーを表示
  - **受入基準:**
    - [ ] サマリーが正しい位置に表示される
    - [ ] コンポーネントテストが通る
  - _要件: 9.8_

- [ ] 4.7.3 Unsplash帰属表示の実装
  - 画像の下に帰属表示を追加
  - 「Photo by {photographer} on Unsplash」形式
  - **受入基準:**
    - [ ] 帰属表示が画像の下に表示される
    - [ ] 写真家名とUnsplashリンクが含まれる
    - [ ] コンポーネントテストが通る
  - _要件: 6.7, 6.8_

### 4.8 Popular Newspapersセクションの更新

- [ ] 4.8.1 検索フィールドの追加
  - セクションタイトルの下に検索フィールドを配置
  - **受入基準:**
    - [ ] 検索フィールドが正しい位置に表示される
    - [ ] モバイルとデスクトップで適切に表示される
    - [ ] コンポーネントテストが通る
  - _要件: 10.2_

- [ ] 4.8.2 言語フィルタの配置
  - 検索フィールドの下または横に配置
  - **受入基準:**
    - [ ] 言語フィルタが適切に配置される
    - [ ] レスポンシブデザインが機能する
    - [ ] コンポーネントテストが通る
  - _要件: 8.11_

- [ ] 4.8.3 ソート選択のデフォルト変更
  - 「Recent」をデフォルトに設定
  - **受入基準:**
    - [ ] ページロード時に「Recent」が選択されている
    - [ ] コンポーネントテストが通る
  - _要件: 7.3, 7.8_

- [ ] 4.8.4 新聞カードの更新
  - 言語バッジを追加
  - ロケール対応の日付表示
  - **受入基準:**
    - [ ] 言語バッジが表示される
    - [ ] 日付がロケールに応じた形式で表示される
    - [ ] コンポーネントテストが通る
  - _要件: 8.13, 10.7, 10.9_

### 4.9 レスポンシブデザインの確認

- [ ] 4.9.1 モバイル表示の確認
  - 検索フィールド、日付ナビゲーション、言語フィルタ
  - **受入基準:**
    - [ ] モバイルで適切に表示される
    - [ ] タッチフレンドリーなサイズ（44px以上）
    - [ ] E2Eテストが通る
  - _要件: 全般_

- [ ] 4.9.2 タブレット表示の確認
  - レイアウトの調整
  - **受入基準:**
    - [ ] タブレットで適切に表示される
    - [ ] E2Eテストが通る
  - _要件: 全般_

- [ ] 4.9.3 デスクトップ表示の確認
  - 3カラムレイアウト
  - **受入基準:**
    - [ ] デスクトップで適切に表示される
    - [ ] E2Eテストが通る
  - _要件: 全般_


## 5. 統合とE2Eテスト

### 5.1 プロパティベーステストの実装

- [ ] 5.1.1 日付範囲フィルタリングのプロパティテスト
  - プロパティ1、2をテスト
  - fast-checkを使用
  - **受入基準:**
    - [ ] 100回以上の反復でテストが通る
    - [ ] プロパティ参照がテスト説明に含まれる
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [ ] 5.1.2 新聞ID形式のプロパティテスト
  - プロパティ3、4をテスト
  - **受入基準:**
    - [ ] 100回以上の反復でテストが通る
    - [ ] プロパティ参照がテスト説明に含まれる
  - _要件: 2.1, 2.2, 2.4, 2.5_

- [ ] 5.1.3 再生成動作のプロパティテスト
  - プロパティ5、6をテスト
  - **受入基準:**
    - [ ] 100回以上の反復でテストが通る
    - [ ] プロパティ参照がテスト説明に含まれる
  - _要件: 3.7, 3.8_

- [ ] 5.1.4 シリーズデータ一貫性のプロパティテスト
  - プロパティ7をテスト
  - **受入基準:**
    - [ ] 100回以上の反復でテストが通る
    - [ ] プロパティ参照がテスト説明に含まれる
  - _要件: 4.1, 4.6, 4.7_

- [ ] 5.1.5 日付ナビゲーション範囲のプロパティテスト
  - プロパティ8をテスト
  - **受入基準:**
    - [ ] 100回以上の反復でテストが通る
    - [ ] プロパティ参照がテスト説明に含まれる
  - _要件: 5.2, 5.7, 5.10, 5.11_

- [ ] 5.1.6 メイン記事画像保証のプロパティテスト
  - プロパティ9、10をテスト
  - **受入基準:**
    - [ ] 100回以上の反復でテストが通る
    - [ ] プロパティ参照がテスト説明に含まれる
  - _要件: 6.3, 6.6, 6.7, 6.8, 6.9, 6.10_

- [ ] 5.1.7 ソート順正確性のプロパティテスト
  - プロパティ11をテスト
  - **受入基準:**
    - [ ] 100回以上の反復でテストが通る
    - [ ] プロパティ参照がテスト説明に含まれる
  - _要件: 7.5, 7.6_

- [ ] 5.1.8 言語フィルタ正確性のプロパティテスト
  - プロパティ12をテスト
  - **受入基準:**
    - [ ] 100回以上の反復でテストが通る
    - [ ] プロパティ参照がテスト説明に含まれる
  - _要件: 8.4, 8.5, 8.6, 8.7_

- [ ] 5.1.9 サマリー生成のプロパティテスト
  - プロパティ13、14、15をテスト
  - **受入基準:**
    - [ ] 100回以上の反復でテストが通る
    - [ ] プロパティ参照がテスト説明に含まれる
  - _要件: 9.5, 9.6, 9.10, 9.13_

- [ ] 5.1.10 タイムゾーン表示のプロパティテスト
  - プロパティ16をテスト
  - **受入基準:**
    - [ ] 100回以上の反復でテストが通る
    - [ ] プロパティ参照がテスト説明に含まれる
  - _要件: 10.2, 10.3, 10.4_

- [ ] 5.1.11 検索機能のプロパティテスト
  - プロパティ17、18、19、20をテスト
  - **受入基準:**
    - [ ] 100回以上の反復でテストが通る
    - [ ] プロパティ参照がテスト説明に含まれる
  - _要件: 10.6, 10.7, 10.8, 10.10_

### 5.2 E2Eテストの実装（Playwright）

- [ ] 5.2.1 新聞検索フローのE2Eテスト
  - 検索クエリ入力 → 結果フィルタリング → 新聞クリック
  - **受入基準:**
    - [ ] 検索フローが正しく動作する
    - [ ] 大文字小文字区別なしで検索できる
    - [ ] 部分一致で検索できる
    - [ ] E2Eテストが通る
  - _要件: 10.4, 10.5, 10.6, 10.7_

- [ ] 5.2.2 検索結果0件のE2Eテスト
  - 存在しない新聞名で検索
  - **受入基準:**
    - [ ] 「検索結果が見つかりませんでした」が表示される
    - [ ] E2Eテストが通る
  - _要件: 10.9_

- [ ] 5.2.3 日付ナビゲーションのE2Eテスト
  - 新聞表示 → 「前の日」クリック → 日付変更確認
  - **受入基準:**
    - [ ] 前日の新聞に遷移できる
    - [ ] 日付が正しく変更される
    - [ ] E2Eテストが通る
  - _要件: 5.3, 5.4, 5.5, 5.6_

- [ ] 5.2.4 日付ナビゲーション無効化のE2Eテスト
  - 2日以上前の新聞でボタンが無効化される
  - **受入基準:**
    - [ ] ボタンが無効化される
    - [ ] ツールチップが表示される
    - [ ] E2Eテストが通る
  - _要件: 5.7, 5.8_

- [ ] 5.2.5 新聞再生成のE2Eテスト
  - 「再生成」クリック → 確認 → 更新確認
  - **受入基準:**
    - [ ] 確認ダイアログが表示される
    - [ ] 再生成が正しく動作する
    - [ ] 更新されたコンテンツが表示される
    - [ ] E2Eテストが通る
  - _要件: 3.1, 3.2, 3.3, 3.4, 3.9_

- [ ] 5.2.6 言語フィルタのE2Eテスト
  - ロケール選択 → フィルタリング確認
  - **受入基準:**
    - [ ] 各ロケールでフィルタリングできる
    - [ ] 「All」で全件表示される
    - [ ] E2Eテストが通る
  - _要件: 8.4, 8.5, 8.6, 8.7_

- [ ] 5.2.7 サマリー表示のE2Eテスト
  - 新聞生成 → サマリー表示確認
  - **受入基準:**
    - [ ] 3行サマリーが表示される
    - [ ] 正しい位置に表示される
    - [ ] E2Eテストが通る
  - _要件: 9.8, 9.9_

- [ ] 5.2.8 タイムゾーン表示のE2Eテスト
  - ロケール切り替え → 日付形式変更確認
  - **受入基準:**
    - [ ] 各ロケールで正しい日付形式が表示される
    - [ ] E2Eテストが通る
  - _要件: 10.4, 10.5, 10.6_

- [ ] 5.2.9 モバイルレスポンシブのE2Eテスト
  - モバイルデバイスエミュレーションでテスト
  - **受入基準:**
    - [ ] 検索フィールドが適切に表示される
    - [ ] 日付ナビゲーションが適切に表示される
    - [ ] タッチフレンドリーなサイズ
    - [ ] E2Eテストが通る
  - _要件: 全般_

### 5.3 パフォーマンステスト

- [ ] 5.3.1 サマリー生成時間の測定
  - 10秒未満を確認
  - **受入基準:**
    - [ ] サマリー生成が10秒未満で完了する
    - [ ] パフォーマンステストが通る
  - _要件: 9.12_

- [ ] 5.3.2 Unsplash APIレスポンス時間の測定
  - 5秒未満を確認
  - **受入基準:**
    - [ ] Unsplash API呼び出しが5秒未満で完了する
    - [ ] パフォーマンステストが通る
  - _要件: 6.4_

- [ ] 5.3.3 検索フィルタリングパフォーマンスの測定
  - 100件の新聞で100ms未満を確認
  - **受入基準:**
    - [ ] 検索フィルタリングが100ms未満で完了する
    - [ ] パフォーマンステストが通る
  - _要件: 10.4_

- [ ] 5.3.4 日付ナビゲーションパフォーマンスの測定
  - 500ms未満を確認
  - **受入基準:**
    - [ ] 前日新聞の読み込みが500ms未満で完了する
    - [ ] パフォーマンステストが通る
  - _要件: 5.3_

- [ ] 5.3.5 再生成時間の測定
  - 15秒未満を確認
  - **受入基準:**
    - [ ] 再生成が15秒未満で完了する
    - [ ] パフォーマンステストが通る
  - _要件: 3.4_


## 6. 最終デプロイと検証

### 6.1 データベースマイグレーション

- [ ] 6.1.1 マイグレーションスクリプトの作成
  - `scripts/migrate-phase1-to-phase2.ts`を作成
  - 既存新聞にPhase 2フィールドを追加
  - **受入基準:**
    - [ ] マイグレーションスクリプトが作成されている
    - [ ] ドライラン（テスト実行）が成功する
  - _要件: 全般_

- [ ] 6.1.2 マイグレーションの実行
  - 本番環境でマイグレーションを実行
  - バックアップを取得
  - **受入基準:**
    - [ ] すべての新聞が正しくマイグレーションされる
    - [ ] データ損失がない
    - [ ] ロールバック可能な状態を維持
  - _要件: 全般_

- [ ] 6.1.3 GSIの作成と確認
  - PublicNewspapersByDateとPublicNewspapersByViewsを作成
  - インデックスの構築完了を待つ
  - **受入基準:**
    - [ ] GSIが正しく作成される
    - [ ] インデックスが完全に構築される
    - [ ] クエリが正しく動作する
  - _要件: 4.3_

### 6.2 インフラストラクチャのデプロイ

- [ ] 6.2.1 Terraformの更新と適用
  - DynamoDB GSIを追加
  - Lambda環境変数を更新（UNSPLASH_ACCESS_KEY）
  - Lambda タイムアウトを60秒に増加
  - **受入基準:**
    - [ ] `terraform plan`が成功する
    - [ ] `terraform apply`が成功する
    - [ ] すべてのリソースが正しく更新される
  - _要件: 全般_

- [ ] 6.2.2 環境変数の設定
  - Amplifyに環境変数を追加
  - Lambda に環境変数を追加
  - **受入基準:**
    - [ ] UNSPLASH_ACCESS_KEYが設定されている
    - [ ] BEDROCK_REGIONが設定されている
    - [ ] Phase 2機能フラグが設定されている
  - _要件: 全般_

### 6.3 バックエンドのデプロイ

- [ ] 6.3.1 Dockerイメージのビルドとプッシュ
  - Phase 2コードを含むイメージをビルド
  - ECRにプッシュ
  - **受入基準:**
    - [ ] Dockerイメージが正しくビルドされる
    - [ ] ECRにプッシュされる
    - [ ] イメージタグが適切に設定される
  - _要件: 全般_

- [ ] 6.3.2 Lambda関数の更新
  - 新しいイメージでLambda関数を更新
  - **受入基準:**
    - [ ] Lambda関数が正しく更新される
    - [ ] ヘルスチェックエンドポイントが200 OKを返す
    - [ ] CloudWatch Logsにエラーがない
  - _要件: 全般_

### 6.4 フロントエンドのデプロイ

- [ ] 6.4.1 Amplifyへのデプロイ
  - mainブランチにプッシュ
  - Amplifyの自動ビルドとデプロイを待つ
  - **受入基準:**
    - [ ] Amplifyビルドが成功する
    - [ ] デプロイが成功する
    - [ ] 本番サイトにアクセスできる
  - _要件: 全般_

### 6.5 本番環境の検証

- [ ] 6.5.1 バックエンドAPIの検証
  - ヘルスチェックエンドポイント
  - サマリー生成エンドポイント
  - Unsplash統合
  - 日付範囲フィルタリング
  - 再生成エンドポイント
  - 検索エンドポイント
  - **受入基準:**
    - [ ] すべてのエンドポイントが正しく動作する
    - [ ] Phase 1エンドポイントも引き続き動作する
    - [ ] エラーログがない
  - _要件: 全般_

- [ ] 6.5.2 フロントエンドの検証
  - 検索フィールドの動作確認
  - 言語フィルタの動作確認（3ロケール）
  - 日付ナビゲーションの動作確認
  - サマリー表示の確認
  - タイムゾーン表示の確認
  - 再生成ボタンの動作確認
  - モバイルレスポンシブの確認
  - **受入基準:**
    - [ ] すべての新機能が正しく動作する
    - [ ] Phase 1機能も引き続き動作する
    - [ ] コンソールエラーがない
  - _要件: 全般_

- [ ] 6.5.3 データベースの検証
  - すべての新聞が正しくマイグレーションされている
  - GSIクエリが正しく動作する
  - データ損失がない
  - **受入基準:**
    - [ ] マイグレーション前後でデータ数が一致する
    - [ ] GSIクエリが正しい結果を返す
    - [ ] データ整合性が保たれている
  - _要件: 全般_

### 6.6 モニタリングとアラートの設定

- [ ] 6.6.1 CloudWatch Alarmsの設定
  - Lambda エラー率 > 5%
  - Lambda 実行時間 > 50秒
  - DynamoDB スロットルリクエスト > 10
  - API Gateway 5xxエラー > 1%
  - **受入基準:**
    - [ ] すべてのアラームが設定されている
    - [ ] アラーム通知が正しく動作する
  - _要件: 全般_

- [ ] 6.6.2 メトリクスの監視
  - サマリー生成成功率
  - Unsplash API成功率
  - 検索クエリパフォーマンス
  - 再生成完了時間
  - データベースクエリレイテンシ
  - **受入基準:**
    - [ ] すべてのメトリクスが収集されている
    - [ ] ダッシュボードで確認できる
  - _要件: 全般_

### 6.7 ドキュメントの更新

- [ ] 6.7.1 README.mdの更新
  - Phase 2機能を追加
  - 新しい環境変数を記載
  - **受入基準:**
    - [ ] README.mdが更新されている
    - [ ] 200行以内に収まっている
    - [ ] 英語で記載されている
  - _要件: 全般_

- [ ] 6.7.2 tech.mdの更新
  - Phase 2のアーキテクチャを追加
  - 新しいサービスを記載
  - **受入基準:**
    - [ ] tech.mdが更新されている
    - [ ] Phase 2の技術詳細が記載されている
  - _要件: 全般_

- [ ] 6.7.3 product.mdの更新
  - Phase 2機能を追加
  - 更新履歴を記録
  - **受入基準:**
    - [ ] product.mdが更新されている
    - [ ] 更新履歴に日付と変更内容が記載されている
  - _要件: 全般_

### 6.8 最終確認

- [ ] 6.8.1 全機能の動作確認
  - Phase 1とPhase 2のすべての機能を確認
  - **受入基準:**
    - [ ] すべての機能が正しく動作する
    - [ ] パフォーマンスが要件を満たす
    - [ ] エラーがない
  - _要件: 全般_

- [ ] 6.8.2 ロールバック計画の確認
  - ロールバック手順を文書化
  - バックアップが取得されている
  - **受入基準:**
    - [ ] ロールバック手順が文書化されている
    - [ ] 必要に応じてロールバックできる
  - _要件: 全般_

- [ ] 6.8.3 チームへの共有
  - Phase 2のリリースノートを作成
  - 新機能の使い方を共有
  - **受入基準:**
    - [ ] リリースノートが作成されている
    - [ ] チームメンバーに共有されている
  - _要件: 全般_

---

## 完了

すべてのタスクが完了したら、Phase 2の実装は完了です。

**次のステップ:**
- ユーザーフィードバックの収集
- パフォーマンスの監視
- Phase 3の計画

