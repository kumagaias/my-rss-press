# ポストモーテムガイドライン

## 概要

ポストモーテムは、インシデントや問題が発生した際に、その原因と対策を記録するドキュメントです。

## 目的

- 同じ問題の再発を防ぐ
- チーム全体で知識を共有する
- プロセスとツールを改善する
- 透明性を保ち、学習文化を促進する

## 記録すべき事象

以下のような事象が発生した場合、ポストモーテムを作成すること：

1. **セキュリティインシデント**
   - 機密情報の漏洩
   - 認証情報の誤コミット
   - セキュリティチェックの失敗

2. **本番環境の障害**
   - サービスダウン
   - データ損失
   - パフォーマンス劣化

3. **重大なバグ**
   - ユーザーに影響を与えるバグ
   - データ整合性の問題
   - デプロイの失敗

4. **プロセスの問題**
   - ツールの誤用
   - ドキュメント不足による問題
   - コミュニケーションの失敗

## ポストモーテムの構成

### 1. インシデント概要
- 何が起きたか（1-2文で簡潔に）
- いつ発生したか
- 重要度（High/Medium/Low）

### 2. タイムライン
- 発生から解決までの時系列
- 各ステップでの対応

### 3. 根本原因
- なぜ問題が発生したか
- 技術的な原因
- プロセス上の原因

### 4. 影響範囲
- 何が影響を受けたか
- ユーザーへの影響
- システムへの影響

### 5. 解決策
- どのように問題を解決したか
- 実施した対応

### 6. 再発防止策
- 今後同じ問題を防ぐための対策
- プロセスの改善
- ツールの改善
- ドキュメントの更新

## 作成手順

1. **テンプレートを使用**
   ```bash
   cp docs/postmortem/TEMPLATE.md docs/postmortem/YYYY-MM-DD-{{title}}.md
   ```

2. **内容を記入**
   - 事実を正確に記録
   - 簡潔に書く（冗長な説明は避ける）
   - 具体的な対策を記載

3. **READMEを更新**
   - `docs/postmortem/README.md`のインデックスに追加

4. **コミット**
   ```bash
   git add docs/postmortem/
   git commit -m "docs: Add postmortem for [incident]"
   ```

## ベストプラクティス

- **非難しない**: 個人を責めるのではなく、システムとプロセスの改善に焦点を当てる
- **簡潔に**: 長文は避け、要点を明確に
- **具体的に**: 曖昧な表現ではなく、具体的な事実と対策を記載
- **タイムリーに**: インシデント解決後、できるだけ早く作成
- **共有する**: チーム全体で読み、学びを共有

## 過去のインシデント（教訓）

### 2025-12-02: Terraform tfplan漏洩
- **原因**: tfplanファイルをコミット、gitleaksが`--staged`のみでコミット後をチェックせず
- **対策**: tfplanを.gitignoreに追加、gitleaksで最新コミットもチェック
- **教訓**: バイナリファイルは明示的に除外、セキュリティチェックはコミット後も実行

詳細: `docs/postmortem/` ディレクトリを参照
