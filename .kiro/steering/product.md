# Product Specification - MyRSSPress

このドキュメントはMyRSSPressの製品仕様を記載しています。

**関連ドキュメント:**
- [tech.md](./tech.md) - 技術アーキテクチャ
- [tech-common.md](./tech-common.md) - 汎用的なベストプラクティス
- [structure.md](./structure.md) - プロジェクト構造
- [project-standards.md](./project-standards.md) - プロジェクト標準

---

## 製品概要

MyRSSPressは、RSSフィードを視覚的に魅力的な新聞スタイルのレイアウトに変換するWebアプリケーションです。ユーザーは興味のあるトピックを入力し、AIによるRSSフィード提案を受け取り、フィードを選択して、リアルな紙のテクスチャとインテリジェントな記事レイアウトを備えたパーソナライズされたデジタル新聞を生成します。

## コア機能

### 1. 多言語対応

**機能:** ブラウザの言語設定に基づいて日本語または英語でインターフェースを表示

**仕様:**
- ブラウザ言語が日本語 → 日本語UI
- ブラウザ言語が日本語以外 → 英語UI
- すべてのUIテキスト、ラベル、メッセージを翻訳
- 日付フォーマットもロケールに対応

**実装:**
- `lib/i18n.ts`で翻訳管理
- `useTranslations(locale)`フックで翻訳取得
- `detectLocale()`でブラウザ言語を自動検出

### 2. 統合ホーム画面

**機能:** 1つの画面で興味入力、フィード管理、人気の新聞閲覧を実現

**セクション:**
1. **興味入力セクション**
   - テーマキーワード入力
   - Enterキーまたはボタンで送信
   - AI駆動のフィード提案

2. **フィード管理セクション**
   - 手動フィードURL追加
   - フィード削除
   - 重複防止機能

3. **人気の新聞セクション**
   - 他のユーザーが作成した公開新聞を表示
   - 並び替え: 人気順（閲覧数）/ 新着順（作成日）
   - 新聞カード: サムネイル、タイトル、作成者、日付、トピック、閲覧数

### 3. AIフィード提案

**機能:** テーマに基づいてAIがRSSフィードを提案

**仕様:**
- **AI**: AWS Bedrock (Claude 3 Haiku)
- **提案数**: 10個のフィード
- **検証**: 各URLの存在確認（HEAD リクエスト、5秒タイムアウト）
- **並列処理**: Promise.allで並列検証（最大15倍高速化）
- **フォールバック**: 無効なURLが多い場合、デフォルトフィード（BBC, NYT等）で補充
- **最低保証**: 5個のフィード

**パフォーマンス:**
- レスポンス時間: ~30-40秒
- Lambda タイムアウト: 60秒

**プロンプト制約:**
- 実在するフィードのみ提案
- 大手メディアや公式サイトを優先
- 正しいフィードURL形式（/rss, /feed, /rss.xml等）
- テーマとの関連度順に並べる

### 4. 新聞生成

**機能:** 選択したフィードから新聞を生成

**記事取得:**
- **記事数**: 8〜15記事（ランダム）
- **期間**: 最新3日間 → 不足時は7日間まで拡張
- **優先順位**: RSS公開日の新しい順
- **データ**: タイトル、説明、リンク、画像、公開日

**記事の重要度計算:**
- **AI**: AWS Bedrock (Claude 3 Haiku)
- **考慮要素**:
  1. テーマとの関連性（最優先）
  2. 画像の有無（+10点ボーナス）
  3. タイトルの長さ
- **フォールバック**: Bedrock失敗時はタイトル長と画像有無で計算

**レイアウト:**
- **リード記事**: 最も重要度の高い記事（大きく表示）
- **トップストーリー**: 次に重要な記事（3カラム）
- **その他**: 残りの記事（2カラム）

**パフォーマンス:**
- 目標: 5秒以内
- 高負荷時: 8秒未満

### 5. 新聞設定とメタデータ

**機能:** 新聞生成後にユーザー名と新聞名を設定

**設定項目:**
- **新聞名**: デフォルト自動生成、ユーザーが変更可能
- **ユーザー名**: 任意入力
- **公開設定**: 公開/非公開

**表示:**
- 新聞ヘッダーに新聞名、作成日、ユーザー名を表示
- 保存済みステータスの表示

### 6. 紙テクスチャデザイン

**機能:** 本物の新聞のような視覚体験

**デザイン要素:**
- **背景**: リアルな紙のテクスチャ
- **フォント**: セリフフォント（伝統的な新聞タイポグラフィ）
- **一貫性**: すべての要素で統一された視覚テーマ

**パフォーマンス:**
- テクスチャアセットの読み込み: 2秒以内

### 7. 画像表示

**機能:** 記事に画像がある場合は表示

**画像ソース:**
- RSS enclosure（`<enclosure>`タグ）
- Media RSS（`media:content`, `media:thumbnail`）
- 記事コンテンツ内の`<img>`タグ
- フィードの`<image>`タグ

**実装:**
- `rssFetcherService.ts`の`extractImageUrl()`で抽出
- `Article`インターフェースに`imageUrl?: string`フィールド

### 8. レスポンシブデザイン

**機能:** すべてのデバイスで快適に表示

**ブレークポイント:**
- **モバイル**: 1カラムレイアウト
- **タブレット**: 適切なブレークポイントで調整
- **デスクトップ**: 3カラムレイアウト

**要件:**
- テキストの可読性を維持
- レイアウトの適切な調整

## 技術仕様

### フロントエンド
- **Framework**: Next.js 15.x (App Router)
- **Language**: TypeScript 5.9.x
- **Styling**: Tailwind CSS 3.x
- **Hosting**: AWS Amplify

### バックエンド
- **Runtime**: AWS Lambda (Node.js 24.x)
- **Framework**: Hono 4.x
- **Language**: TypeScript 5.9.x
- **Database**: DynamoDB
- **AI**: AWS Bedrock (Claude 3 Haiku)

### インフラ
- **IaC**: Terraform 1.11.x
- **CI/CD**: AWS Amplify (Frontend), GitHub Actions (Backend)
- **Region**: ap-northeast-1 (Tokyo)

## 品質要件

### テスト
- **カバレッジ**: 60%以上
- **ユニットテスト**: Jest/Vitest
- **E2Eテスト**: Playwright
- **テストシナリオ**:
  - 新聞作成フロー
  - 手動フィード追加と削除
  - 新聞設定の保存
  - 人気の新聞の閲覧と並び替え
  - レスポンシブデザイン

### セキュリティ
- **機密情報チェック**: Gitleaks（pre-commit/pre-push）
- **環境変数管理**: `.env.local`（gitignore済み）
- **AWS認証**: 環境変数またはAWS Secrets Manager
- **入力検証**: すべてのAPIエンドポイントでバリデーション
- **CORS**: 許可されたオリジンのみ

### パフォーマンス
- **新聞生成**: 5秒以内（目標）、8秒未満（高負荷時）
- **フィード提案**: 30-40秒
- **並列処理**: フィード取得、URL検証

## ユーザーフロー

### 新聞作成フロー
```
1. ホーム画面にアクセス
   ↓
2. テーマキーワードを入力
   ↓
3. AIがフィードを提案（自動追加）
   ↓
4. 必要に応じて手動でフィード追加/削除
   ↓
5. 「新聞を生成」ボタンをクリック
   ↓
6. 新聞ページが表示される
   ↓
7. 「保存」ボタンで設定モーダルを開く
   ↓
8. 新聞名、ユーザー名、公開設定を入力
   ↓
9. 保存完了
```

### 人気の新聞閲覧フロー
```
1. ホーム画面にアクセス
   ↓
2. 人気の新聞セクションをスクロール
   ↓
3. 並び替え（人気順/新着順）を選択
   ↓
4. 新聞カードをクリック
   ↓
5. 新聞詳細ページが表示される
```

## 用語集

- **テーマキーワード**: ユーザーが入力する興味分野（例：「Tech」「スポーツ」）
- **RSSフィード**: Webサイトからのコンテンツ配信形式
- **フィード提案**: AIが生成するRSSフィードURLの推薦
- **新聞ページ**: 新聞スタイルで記事を表示する生成された出力
- **記事重要度**: 視覚的な目立ち度を決定する計算されたメトリック
- **紙テクスチャ**: 物理的な新聞の外観をシミュレートする視覚スタイル
- **ロケール**: ユーザーの言語設定（日本語または英語）
- **統合ホーム画面**: 興味入力、フィード管理、人気の新聞を1画面に統合
- **新聞設定**: 新聞名、ユーザー名、公開/非公開設定

## 更新履歴

このドキュメントは製品仕様の変更に応じて更新されます。

- **2025-12-05**: 初版作成
  - Phase 1 (MVP) の仕様を統合
  - フィード提案のパフォーマンス最適化を反映（15個→10個）
  - 画像表示機能を追加
